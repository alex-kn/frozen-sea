# Frozen-Sea

Frozen-Sea is a website designated to create, manage and participate in user-studies at Ludwig-Maximilians University Munich. The website was designed and built during the "Practical Course Web Development" at Ludwig-Maximilians University Munich.

# Frameworks and Tools
The project REST-API is generated by [LoopBack](http://loopback.io).
The frontend was built in [angular.js](https://angularjs.org) with the use of [Angular Material](https://material.angularjs.org).
We use [MongoDB](https://www.mongodb.com) with [mLab](https://mlab.com) as database.

# Deployment
When deploying the project to a new server you need to follow these steps:
1) Install node and npm.  
2) Perform "npm install" in the parent directory as well as in the "client" directory.  
3) If "bower install" is not performed automatically by "npm install" you need to perform this command in both folders too.  
4) Change the API URL in the client/app/app.config.js inside LoopBackResourceProvider.setUrlBase('http://localhost:3000/api') to the the new API URL.  
5) Edit common/models/Subuser.js:  
    5.1)Change the options object in the Subuser.afterRemote('create', function (context, Subuser, next) function.  
        Set options.host to your hostadress (in our deployed version 'frozen-sea.herokuapp.com'):  
        Set options.port to 80.  
    5.2)Change the options object in the Subuser.on('resetPasswordRequest', function (info) function:  
        Set options.host to your hostadress (in our deployed version 'frozen-sea.herokuapp.com').  
        Set options.port to 80.  

# Changing the datasource
1) You need to change the \server\datasources.json file to point to the new database.  
2) You need to create (e.g. copy) the following roles in the database, inside a collection named "Role":   

{
    "_id": {
        "$oid": "58bc4281b4660d0d66daeb90"
    },
    "name": "advisor",
    "created": {
        "$date": "2017-03-05T16:53:21.425Z"
    },
    "modified": {
        "$date": "2017-03-05T16:53:21.425Z"
    }
}
  
AND  

{
    "_id": {
        "$oid": "58bc42e50435dc1f661f62ec"
    },
    "name": "admin",
    "created": {
        "$date": "2017-03-05T16:55:00.962Z"
    },
    "modified": {
        "$date": "2017-03-05T16:55:00.962Z"
    }
}  

3) You need at least one admin account. First register a new account and then create a collection named "RoleMapping". Elevate the account to admin by adding

{
    "_id": {
        "$oid": "58c89db9bdc0119431742940"
    },
    "principalType": "USER",
    "principalId": "58b5be7e6efdc2e829839ac5",
    "roleId": {
        "$oid": "58bc42e50435dc1f661f62ec"
    }
}  

where principalId is the id of your new admin account, roldeId is the id of the role and id is a random new id for the RoleMapping instance.  
The calculation of experiment hours is tied to the Subuser, Preference and Participation objects, so all three need to be migrated if no experiment hours should be lost.
 
# Changing the website email-adresss
You need to change the \server\datasources.json file to point to the new email account.
Additionally you need to change all mentions of the old email in all the localization files. Best you perform a complete replace-all refactor over the whole project.

# API Reference
A complete API Reference is provided by navigating to https://#path-to-website#/explorer
To do so, you first you need to change \server\component-config.json from  
{
  "loopback-component-explorer": null
}  

to  
{
  "loopback-component-explorer": {
    "mountPath": "/explorer"
  }
}  
For retrieving experiment hours of one student, call https://#path-to-api#/Subusers/getVpsByMat/:mat    
For retrieving experiment hours of all students, call https://#path-to-api#/Subusers/getAllVps  



In the original version #path-to-website# resolves to https://frozen-sea.herokuapp.com and #path-to-api# to https://frozen-sea.herokuapp.com/api.

# Contributors
The website was designed and built by Alexander Knittel, Fabian Plett, Jan Mayer and Mathis Gales, with the help and supervision of Juliane Franze and Tobias Seitz
For more information or help, please contact: mathis.gales@gmail.com.


***

# Getting Started

Frozen Sea is a website designated to create, manage and participate in user studies at Ludwig-Maximilians Universit√§t Munich.

## Home

The **Study List** is displayed after logging in for the first time, which shows all available studies for the user. Users can filter this list according to their wishes and click on a study will take them to the detail page of the respective study.

The user's relation to the study is indicated by color:
* **green:** the user is participating in this study and was confirmed by the study organizer
* **blue:** the user is participating in this study and was not yet confirmed
* ...

## Preferences

The user can specifiy details about himself on the preference page. These preferences are are used to filter studies accordingly. For isntance, a study requiring an android phone is not shown to a user who has specified that he has no such phone.

Note that only users who have their student number specified can choose experimental hours as a reward.

## Creating a new Study

![](./readme-img/create-study.png)


All user's can create a new study by clicking the **Create Study** Button. The subsequently appearing page consists of two tabs in which users can modify and adjust their study to their needs.

##### General Information
* General details about the study
    * Title
    * Description
    * Standard duration of one appointment
    * Keywords
    * All distinct locations of the study appointments
    * The supervisor of the study (needs to unlock the study)
* Possible rewards
* Adding appointments
    * Start time
    * Buffer between appointments (only used to increment start time after adding for convenience, not saved)
    * Date
    * Location
    * Maximumn number of participants
    * Deadline for registering (hours in advance)

##### Requirements

In this tab, requirements for participating in the study can be specified. These requirements are used to help showing the study to suiting applicants.

##### Online Study

Studies which are conducted online do not require appointments and rewards. By checking this box, a new input field for the URL of the study will appear, which is necessary for possible applicants to participate.

## Participating in a study

By clicking on a study in the list the user ist directied to the **Study Detail Page**, showing more detailed information about the study. Users can register for the study here.

##### Choosing a reward

To participate in a study the user needs to choose a reward, which is either Money, an Amazon gift card or experimental hours. Note that experimental hours can only be chosen if the user specified his student number in the preferences.

##### Applying for an appointment

Users can browse through appointments and apply for an appointment of their liking. After confirmation by the study organizer the user is registered for this specific appointment. The user might also be rejected by the study organizer.

##### Modifying the participation

* Users can withdraw their participation at any time until the deadline has passed, for instance to apply for another appointment.
* Users can change the chosen reward until the deadline has passed.

##### Contacting the study organizer

Users can contact the study organizer using the contact form at the bottom of the page.

## Managing a created study

The **Study Detail Page** shows additional 

### Managing participants

### Editing study deatils

## Supervising a study

