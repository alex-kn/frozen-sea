<link href="views/create-study/create-study.style.css" rel="stylesheet">


<div ng-controller="NavigationController">
    <nav-bar></nav-bar>
</div>

<section ng-controller="CreateStudyController as ctrl">

    <!-- START tool bar -->
    <md-toolbar class="toolbar md-hue-1" layout="row" layout-align="start center">
        <div class="md-toolbar-tools" flex-offset-gt-sm="15">
            <h2 class="md-display-3">
                <i class="material-icons">bubble_chart</i>
                {{ title }}
            </h2>

            <span flex></span>
        </div>
    </md-toolbar>
    <!-- END tool bar -->

    <!-- START create study form -->
    <md-content layout-padding flex-offset-gt-sm="20" flex-gt-sm="60" flex-offset-sm- flex="100">

        <form name="createStudyForm" layout="column">


            <h2 class="md-headline" ng-model="study.name">
                Allgemeines zu
                <span style="color:#FFC107">{{ study.name }}
                </span>
                <i id="edit" class="material-icons">edit</i>
            </h2>

            <!-- START Description -->
            <md-input-container>
                <textarea md-no-asterisk required ng-model="study.description" name="description"
                          md-maxlength="150"
                          aria-label="Description" placeholder="Beschreibung" md-select-on-focus></textarea>
                <div class="hint" hide-xs>Eine ausagekräftige Beschreibung deiner Studie hilft dir bei der
                    Suche nach Teilnehmern.
                </div>

            </md-input-container>
            <!-- END description -->

            <!-- START duration -->
            <md-input-container>
                <input type="number" required aria-label="Dauer" ng-model="study.duration" md-no-asterisk
                       name="duration" placeholder="Dauer" md-select-on-focus>
                <div class="hint" hide-xs>In Minuten = <span
                        style="color: #263238">{{ study.duration / 60 * 3 }} ECTS</span></div>
            </md-input-container>
            <!-- END duration -->

            <!-- START Criteria -->
            <h2 class="md-headline">Studienvoraussetzungen</h2>
            <md-chips ng-model="ctrl.selectedStudyPrograms" md-autocomplete-snap
                      md-transform-chip="ctrl.transformChip($chip)"
                      md-require-match="ctrl.autocompleteRequireMatch">
                <md-autocomplete
                        md-selected-item="ctrl.selectedStudyProgram"
                        md-search-text="ctrl.searchText"
                        md-items="item in ctrl.querySearch(ctrl.searchText)"
                        md-item-text="item.name"
                        placeholder="Suche nach einem Studiengang">
                    <span md-highlight-text="ctrl.searchText">{{item.name}} ({{item.type}})</span>
                </md-autocomplete>
                <md-chip-template>
                    <span>
                      <strong>{{$chip.name}}</strong>
                      <em>({{$chip.type}})</em>
                    </span>
                </md-chip-template>
            </md-chips>
            <!-- END Criteria -->

            <!-- START keywords -->
            <section>
                <h2 class="md-headline">Keywords</h2>
            <md-chips secondary-placeholder="" aria-label="Keywords" placeholder="z.B. Android" name="tags"
                      ng-model="study.tags"
                      readonly="ctrl.readonly"
                      md-removable="ctrl.removable">
            </md-chips>
            <div class="hint hint-chips">Mit ausagekräftigen Keywords können wir deine Studien genau den richtigen
                Teilnehmern
                anzeigen.
            </div></section>
            <!-- END keywords -->

            <!-- START age -->
            <section><h2 class="md-headline after-chips">Alter</h2>
            <md-slider-container layout="row" layout-xs="column">
                <span flex-gt-xs="20" flex-xs="100">Mindestalter</span>
                <md-slider min="0" max="60" ng-model="study.minAge" aria-label="Mindestalter" id="min-age-slider">
                </md-slider>
                <md-input-container hide-xs>
                    <input flex type="number" ng-model="study.minAge" aria-label="Mindestalter"
                           aria-controls="max-age-slider">
                </md-input-container>
            </md-slider-container>

            <md-slider-container layout="row" layout-xs="column" ng-if="hasMaxAge">
                <span flex-gt-xs="20" flex="100">Maximales Alter</span>
                <md-slider md-invert flex ng-model="study.maxAge" min="60" max="100" aria-label="Maximales Alter"
                           id="max-age-slider" class="md-accent">
                </md-slider>
                <md-input-container hide-xs>
                    <input flex type="number" ng-model="study.maxAge" aria-label="Maximales Alter"
                           aria-controls="max-age-slider">
                </md-input-container>
            </md-slider-container>

            <md-input-container style="margin-top:1rem;" layout="row" layout-xs="column">
                <md-checkbox flex-xs="100" ng-model="hasMaxAge" aria-label="Maximales Alter">
                    Hat deine Studie ein maximales Alter?
                </md-checkbox>
            </md-input-container></section>
            <!-- END age -->

            <!-- START rewards -->
            <h2 class="md-headline">Vergütung</h2>
            <md-input-container layout="row" layout-xs="column">
                <md-checkbox flex-xs="100" ng-model="study.rewards.money" aria-label="Geld">
                    Geld
                </md-checkbox>
                <md-checkbox flex-xs="100" ng-model="study.rewards.voucher" aria-label="Amazon Gutschein">
                    Amazon Gutschein
                </md-checkbox>
                <md-checkbox flex-xs="100" ng-model="study.rewards.hours" aria-label="Versuchspersonenstunden">
                    Versuchspersonenstunden
                </md-checkbox>
            </md-input-container>
            <!-- END rewards -->

            <!-- START start and end dates -->
            <h2 class="md-headline">Start- und Enddatum</h2>

            <div layout="row" layout-xs="column">
                <md-input-container flex-gt-xs="50" flex="100">
                    <label>Studienbeginn</label>
                    <md-datepicker required ng-required ng-model="startDate" name="startDate"
                                   md-min-date="startDate"></md-datepicker>

                    <div ng-messages="createStudyForm.startDate.$error">
                        <div ng-message="required">Bitte gebe den Studienbeginn so TT/MM/JJJJ an</div>
                    </div>
                </md-input-container>

                <md-input-container flex-gt-xs="50" flex="100">
                    <label>Studienbeginn</label>
                    <md-datepicker required ng-model="endDate" name="endDate" md-min-date="minEndDate"></md-datepicker>

                    <div ng-messages="createStudyForm.endDate.$error">
                        <div ng-message="required">Bitte gebe das Studienende so TT/MM/JJJJ an</div>
                    </div>
                </md-input-container>
            </div>
            <!-- END start and end dates -->

            <!-- START study dates -->
            <h2 class="md-headline">Termine hinzufügen</h2>

            <div layout="row" layout-xs="column">
                <md-input-container flex="20">
                    <label>Tag</label>
                    <md-datepicker required ng-required ng-model="appointmentDate" md-min-date="startDate"></md-datepicker>
                </md-input-container>
                <md-input-container flex="20">
                    <input type="time" required aria-label="" ng-model="appointmentTime" md-no-asterisk placeholder="Uhrzeit" md-select-on-focus>
                </md-input-container>
                <md-input-container flex="20">
                    <md-button ng-click="addAppointment(appointmentDate, appointmentTime, study.duration)" class="md-raised md-accent">Termin hinzufügen</md-button>
                </md-input-container>
            </div>

            <div layout="row" layout-xs="column" layout-wrap>
                <md-card ng-repeat="appointment in appointments" flex="100" flex-gt-xs="50" flex-gt-sm="25">
                    <md-card-header style="padding-bottom: 0" layout="row" layout-align="end center">
                        <md-button ng-click="removeAppointment(item)" class="md-icon-button md-accent" aria-label="Favorite">
                            <md-icon class="material-icons md-24 md-primary">close</md-icon>
                        </md-button>
                    </md-card-header>
                    <md-card-content style="padding-top: 0" layou="row">
                        <h3 style="margin-top: 0">Termin am {{ appointment.date | date:'dd.MM.yy'  }}</h3>
                        <p><strong>Uhrzeit</strong> {{ appointment.time | date:'HH:mm' }} Minuten</p>
                        <p><strong>Dauer</strong> {{ appointment.duration }} Minuten</p>
                    </md-card-content>
                </md-card>
            </div>
            <!-- END study dates -->

            <!-- START submit -->
            <div layout="row" layout-xs="column">

                <md-input-container>
                    <md-button ng-click="createStudy(study.name, study.description, startDate, endDate)"
                               ng-disabled="createStudyForm.$invalid" class="md-accent md-raised">Studie erstellen
                    </md-button>
                    <md-button ng-click="cancelStudy()">Abbrechen</md-button>
                </md-input-container>

            </div>
            <!-- END submit -->

            <!-- START Invalid form -->
            <div layout="row" layout-xs="column" ng-if="createStudyForm.$invalid">
                <p>Bitte fülle alle Pflichtfelder aus</p>
            </div>
            <!-- END Invalid form -->

        </form>


    </md-content>
    <!-- END create study form -->
</section>
